<?xml version="1.0"?>
<odoo>
    <data>

        <template id="report_saleorder_document_inherit" inherit_id="sale.report_saleorder_document">
            <xpath expr="//table[@class='table table-sm o_main_table']" position="before">
                <t t-set="display_rental" t-value="any([l.rental_qty for l in doc.order_line])"/>

                <div class="row mt32 mb32" id="informations">
                    <div t-if="display_rental" class="col-auto mw-100 mb-2">
                        <strong>Rental since:</strong>
                        <p class="m-0" t-field="doc.default_start_date"/>
                    </div>
                    <div t-if="display_rental" class="col-auto mw-100 mb-2">
                        <strong>Rental to:</strong>
                        <p class="m-0" t-field="doc.default_end_date"/>
                    </div>
                </div>
            </xpath>
            <!--        column header       -->
            <xpath expr="//th[@name='th_description']" position="after">
                <th t-if="display_rental" name="th_duration" class="text-right">Duration</th>
            </xpath>

            <xpath expr="//th[@name='th_priceunit']" position="after">
                <th t-if="display_rental" name="th_guarantee_price" class="text-right">Guarantee Price</th>
            </xpath>

            <xpath expr="//th[@name='th_subtotal']" position="after">
                <th t-if="display_rental" name="th_guarantee_price_total" class="text-right">Guarantee Total</th>
            </xpath>

            <!--        column data       -->
            <xpath expr="//td[@name='td_quantity']" position="replace">
                <td t-if="display_rental" name="td_duration" class="text-right">
                    <span t-field="line.number_of_days"/>
                </td>
                <td name="td_quantity" class="text-right">
                    <span t-if="not display_rental" t-field="line.product_uom_qty"/>
                    <span t-if="display_rental" t-field="line.rental_qty"/>
                    <span t-field="line.product_uom" groups="uom.group_uom"/>
                </td>
            </xpath>

            <xpath expr="//td[@name='td_priceunit']" position="after">
                <td t-if="display_rental" name="td_guarantee_price" class="text-right">
                    <span t-if="display_rental" t-field="line.rental_guarantee_price"/>
                </td>
            </xpath>

            <xpath expr="//td[@name='td_subtotal']" position="after">
                <td t-if="display_rental" name="td_guarantee_price_total" class="text-right">
                    <span t-if="display_rental" t-field="line.rental_guarantee_price_total"/>
                </td>
            </xpath>

            <xpath expr="//t[@t-set='current_subtotal']" position="after">
                <t t-set="current_guarantee_subtotal" t-value="0"/>
            </xpath>

            <xpath expr="//t[@t-value='current_subtotal + line.price_total']" position="after">
                <t t-set="current_guarantee_subtotal" t-value="current_guarantee_subtotal + line.rental_guarantee_price_total"/>
            </xpath>

            <xpath expr="//tr[@class='border-black o_total']" position="after">
                <tr t-if="doc.rental_guarantee_price_total > 0" class="border-black o_guarantee_total">
                    <td name="td_guarantee_total_label"><strong>Guarantee Total</strong></td>
                    <td name="td_guarantee_total" class="text-right">
                        <span t-field="doc.rental_guarantee_price_total"/>
                    </td>
                </tr>
                <tr t-if="doc.rental_guarantee_price_total > 0" class="border-black o_grand_total">
                    <td name="td_grand_total_label"><strong>Grand Total</strong></td>
                    <td name="td_grand_total" class="text-right">
                        <strong t-esc="doc.amount_total + doc.rental_guarantee_price_total" t-options="{'widget': 'monetary', 'display_currency': doc.currency_id}" />
                    </td>
                </tr>
            </xpath>


        </template>

    </data>
</odoo>